/**
 * djax - A lightweight jQuery.ajax subset
 * @version v1.0.0
 * @link https://github.com/jacomyal/djax
 * @license MIT
 */
(function(e){"use strict";function t(r,n){if(!t.xhr)throw new Error("XMLHttpRequest not found. You can specify which XMLHttpRequest you want to use by using `ajax.xhr = myXHR`.");var o=[],s=[];if("string"==typeof r)r={url:r},2===arguments.length&&("function"==typeof n?o.push(n):Array.isArray(n)&&(o=o.concat(n)));else if("object"!=typeof r||!r)throw new Error("Wrong arguments");"function"==typeof r.success?o.push(r.success):Array.isArray(r.success)&&(o=o.concat(r.success)),"function"==typeof r.error?s.push(r.error):Array.isArray(r.error)&&(s=s.concat(r.error));var i,a,u,f,c=!1,y=r.url,p=new t.xhr,d=r.type||"GET",h=r.dataType||"json",l=r.contentType||"application/x-www-form-urlencoded";if(!y||"string"!=typeof y)throw new Error("Wrong arguments");if(r.data){if("string"==typeof r.data)a=r.data;else if(/json/.test(l))a=JSON.stringify(r.data);else{a=[];for(i in r.data)a.push(encodeURIComponent(i)+"="+encodeURIComponent(r.data[i]));a=a.join("&")}/GET|DELETE/i.test(d)&&(y+=/\?/.test(y)?"&"+a:"?"+a,a="")}if(p.onreadystatechange=function(){if(4===+p.readyState)if(u&&clearTimeout(u),/^2/.test(p.status)){if(a=p.responseText,/json/.test(h))try{a=JSON.parse(p.responseText)}catch(e){return f=function(e,t){t.forEach(function(e){e(p,"parsererror")})},void f(null,s)}f=function(e){e.forEach(function(e){e(a,"ok",p)})},f(o)}else(f=function(e,t){t.forEach(function(e){e(p,+p.status?"error":"abort",p.responseText)})})(null,s)},p.open(d,y,!0),p.setRequestHeader("Content-Type",l),r.headers)for(i in r.headers)p.setRequestHeader(i,r.headers[i]);if("function"==typeof r.beforeSend&&r.beforeSend(p,r)===!1)return p.abort();r.timeout&&(u=setTimeout(function(){p.onreadystatechange=function(){},p.abort(),(f=function(e,t){t.forEach(function(e){e(p,"timeout")})})(null,s)},r.timeout)),p.send(a);var m={xhr:p,done:function(e){if("function"==typeof e)o.push(e);else{if(!Array.isArray(e))throw new Error("Wrong arguments.");o=o.concat(e)}return c&&("function"==typeof e?f([e]):Array.isArray(e)&&f(e)),this},fail:function(e){if("function"==typeof e)s.push(e);else{if(!Array.isArray(e))throw new Error("Wrong arguments.");s=s.concat(e)}return c&&("function"==typeof e?f(null,[e]):Array.isArray(e)&&f(null,e)),this},then:function(e,t){return this.done(e),this.fail(t),c&&f(Array.isArray(e)?e:"function"==typeof e?[e]:null,Array.isArray(t)?t:"function"==typeof t?[t]:null),this}};return setTimeout(function(){for(var t in m)m[t]=e},0),m}"undefined"!=typeof XMLHttpRequest&&(t.xhr=XMLHttpRequest),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=t),exports.ajax=t):"function"==typeof define&&define.amd?define("djax",[],function(){return t}):this.ajax=t}).call(this);