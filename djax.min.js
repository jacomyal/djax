/**
 * djax - A lightweight jQuery.ajax subset
 * @version v1.2.0
 * @link https://github.com/jacomyal/djax
 * @license MIT
 */
(function(e){"use strict";function t(n,r){if(!t.xhr)throw new Error("XMLHttpRequest not found. You can specify which XMLHttpRequest you want to use by using `ajax.xhr = myXHR`.");var o=[],s=[];if("string"==typeof n)n={url:n},2===arguments.length&&("function"==typeof r?o.push(r):Array.isArray(r)&&(o=o.concat(r)));else if("object"!=typeof n||!n)throw new Error("Wrong arguments");"function"==typeof n.success?o.push(n.success):Array.isArray(n.success)&&(o=o.concat(n.success)),"function"==typeof n.error?s.push(n.error):Array.isArray(n.error)&&(s=s.concat(n.error));var i,u,f,a,c,y=!1,p=n.url,d=new t.xhr,h=n.method||n.type||"GET",l=n.dataType||"json",x=n.contentType||"application/x-www-form-urlencoded";if(!p||"string"!=typeof p)throw new Error("Wrong arguments");if(n.data){if("string"==typeof n.data)u=n.data;else if(/json/.test(x))u=JSON.stringify(n.data);else{u=[];for(i in n.data)u.push(encodeURIComponent(i)+"="+encodeURIComponent(n.data[i]));u=u.join("&")}/GET|DELETE/i.test(h)&&(p+=/\?/.test(p)?"&"+u:"?"+u,u="")}if(d.onreadystatechange=function(){if(4===+d.readyState)if(y=!0,f&&clearTimeout(f),/^2/.test(d.status)){if(y=!0,c="success",u=d.responseText,/json/.test(l))try{u=u?JSON.parse(u):""}catch(t){return a=function(e,t){t.forEach(function(e){e(d,c="parsererror")})},void a(null,s)}204===+d.status&&(c="nocontent",u=e),a=function(e,t){e.forEach(function(e){e(u,c,d)})},a(o)}else(a=function(e,t){t.forEach(function(e){e(d,+d.status?"error":"abort",d.responseText)})})(null,s)},n.xhrFields&&"object"==typeof n.xhrFields)for(i in n.xhrFields)d[i]=n.xhrFields[i];if(d.open(h,p,!0),d.setRequestHeader("Content-Type",x),n.headers)for(i in n.headers)d.setRequestHeader(i,n.headers[i]);return"function"==typeof n.beforeSend&&n.beforeSend(d,n)===!1?(y=!0,a=function(e,t){t.forEach(function(e){e(d,"abort",d.responseText)})},a(null,s),d.abort()):(n.timeout&&(f=setTimeout(function(){y=!0,d.onreadystatechange=function(){},d.abort(),(a=function(e,t){t.forEach(function(e){e(d,"timeout")})})(null,s)},n.timeout)),d.send(u),d.done=function(e){if("function"==typeof e)o.push(e);else{if(!Array.isArray(e))throw new Error("Wrong arguments.");o=o.concat(e)}return y&&("function"==typeof e?a([e]):Array.isArray(e)&&a(e)),this},d.fail=function(e){if("function"==typeof e)s.push(e);else{if(!Array.isArray(e))throw new Error("Wrong arguments.");s=s.concat(e)}return y&&("function"==typeof e?a(null,[e]):Array.isArray(e)&&a(null,e)),this},d.then=function(e,t){return e&&this.done(e),t&&this.fail(t),y&&a(Array.isArray(e)?e:"function"==typeof e?[e]:null,Array.isArray(t)?t:"function"==typeof t?[t]:null),this},d)}t.version="1.1.0","undefined"!=typeof XMLHttpRequest&&(t.xhr=XMLHttpRequest),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=t),exports.djax=t):"function"==typeof define&&define.amd?define("djax",[],function(){return t}):this.djax=t}).call(this);