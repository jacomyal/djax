/**
 * djax - A lightweight jQuery.ajax subset
 * @version v1.0.1
 * @link https://github.com/jacomyal/djax
 * @license MIT
 */
(function(){"use strict";function e(t,n){if(!e.xhr)throw new Error("XMLHttpRequest not found. You can specify which XMLHttpRequest you want to use by using `ajax.xhr = myXHR`.");var r=[],o=[];if("string"==typeof t)t={url:t},2===arguments.length&&("function"==typeof n?r.push(n):Array.isArray(n)&&(r=r.concat(n)));else if("object"!=typeof t||!t)throw new Error("Wrong arguments");"function"==typeof t.success?r.push(t.success):Array.isArray(t.success)&&(r=r.concat(t.success)),"function"==typeof t.error?o.push(t.error):Array.isArray(t.error)&&(o=o.concat(t.error));var s,i,u,a,f=!1,c=t.url,p=new e.xhr,y=t.type||"GET",d=t.dataType||"json",h=t.contentType||"application/x-www-form-urlencoded";if(!c||"string"!=typeof c)throw new Error("Wrong arguments");if(t.data){if("string"==typeof t.data)i=t.data;else if(/json/.test(h))i=JSON.stringify(t.data);else{i=[];for(s in t.data)i.push(encodeURIComponent(s)+"="+encodeURIComponent(t.data[s]));i=i.join("&")}/GET|DELETE/i.test(y)&&(c+=/\?/.test(c)?"&"+i:"?"+i,i="")}if(p.onreadystatechange=function(){if(4===+p.readyState)if(f=!0,u&&clearTimeout(u),/^2/.test(p.status)){if(f=!0,i=p.responseText,/json/.test(d))try{i=JSON.parse(p.responseText)}catch(e){return a=function(e,t){t.forEach(function(e){e(p,"parsererror")})},void a(null,o)}a=function(e){e.forEach(function(e){e(i,"success",p)})},a(r)}else(a=function(e,t){t.forEach(function(e){e(p,+p.status?"error":"abort",p.responseText)})})(null,o)},p.open(y,c,!0),p.setRequestHeader("Content-Type",h),t.headers)for(s in t.headers)p.setRequestHeader(s,t.headers[s]);return"function"==typeof t.beforeSend&&t.beforeSend(p,t)===!1?(f=!0,a=function(e,t){t.forEach(function(e){e(p,"abort",p.responseText)})},a(null,o),p.abort()):(t.timeout&&(u=setTimeout(function(){f=!0,p.onreadystatechange=function(){},p.abort(),(a=function(e,t){t.forEach(function(e){e(p,"timeout")})})(null,o)},t.timeout)),p.send(i),p.done=function(e){if("function"==typeof e)r.push(e);else{if(!Array.isArray(e))throw new Error("Wrong arguments.");r=r.concat(e)}return f&&("function"==typeof e?a([e]):Array.isArray(e)&&a(e)),this},p.fail=function(e){if("function"==typeof e)o.push(e);else{if(!Array.isArray(e))throw new Error("Wrong arguments.");o=o.concat(e)}return f&&("function"==typeof e?a(null,[e]):Array.isArray(e)&&a(null,e)),this},p.then=function(e,t){return this.done(e),this.fail(t),f&&a(Array.isArray(e)?e:"function"==typeof e?[e]:null,Array.isArray(t)?t:"function"==typeof t?[t]:null),this},p)}e.version="1.0.1","undefined"!=typeof XMLHttpRequest&&(e.xhr=XMLHttpRequest),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),exports.ajax=e):"function"==typeof define&&define.amd?define("djax",[],function(){return e}):this.ajax=e}).call(this);